import { AnalysisTask, DiagnosticTask } from "src/taskProviders";

/**
 * Represents application metadata and coordinates
 */
export interface TestApplication {
  readonly path: string; // path to app.yaml
  readonly name: string;
  readonly sourceCode:
    | {
        type: "git";
        url: string;
        branch: string;
        path?: string;
      }
    | {
        type: "local";
        path: string;
      };
  readonly programmingLanguage: string;
  readonly architecture: string;
  readonly sources?: string[];
  readonly targets?: string[];
}

/**
 * Represents test case metadata and coordinates
 */
export interface TestCase {
  readonly path: string; // path to tc.yaml
  readonly name: string;
  readonly description: string;
  readonly rules: {
    readonly ruleset: string;
    readonly rule: string;
  }[];
  readonly migrationHint: string;
  readonly testSelectors?: string[];
  readonly application: TestApplication;
  readonly notes: string;
}

// Each test case is run under different parameters
export interface TestCaseResults {
  readonly testCase: TestCase;
  errors: Error[];
  results: ExperimentResults[];
}

export interface ExperimentResults {
  readonly name: string;
  readonly completeness: Metric;
  readonly functionalParity: Metric;
  readonly residualEffort: Metric;
  readonly diff: string; // diff generated by the model is included in the results
}

export interface Metric {
  readonly reasoning: string;
  readonly score: number;
}

export interface EvaluationRunner {
  run: (testCases: TestCase[]) => Promise<TestCaseResults[]>;
}

export interface BeforeAfter<T> {
  readonly before: T;
  readonly after: T;
}

export interface EvaluationToolOptions {
  readonly analysisIssues: BeforeAfter<AnalysisTask[]>;
  readonly diagnosticsIssues: BeforeAfter<DiagnosticTask[]>;
  readonly fileList: BeforeAfter<string[]>;
  readonly changedFiles: Map<string, string>;
  readonly appArchitecture: string;
  readonly originalRules: {
    readonly ruleset: string;
    readonly rule: string;
  }[];
}
